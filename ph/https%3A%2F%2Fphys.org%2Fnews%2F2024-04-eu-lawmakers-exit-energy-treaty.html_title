EU lawmakers agree to exit energy treaty over climate fears